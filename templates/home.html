{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block extra_styles %}
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.dashboard-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
    transition: transform 0.2s, box-shadow 0.2s;
}

.dashboard-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
}

.card-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: white;
}

.card-icon.conversations {
    background: #075e54;
}

.card-icon.active {
    background: #25d366;
}

.card-icon.areas {
    background: #128c7e;
}

.card-icon.responses {
    background: #34d399;
}

.card-title {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    margin: 0;
}

.card-number {
    font-size: 32px;
    font-weight: 700;
    color: #075e54;
    margin-bottom: 8px;
}

.card-description {
    font-size: 14px;
    color: #666;
}

.quick-actions {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
    margin-bottom: 30px;
}

.actions-title {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    margin-bottom: 15px;
}

.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.action-button {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 15px;
    background: #f8f9fa;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    text-decoration: none;
    color: #333;
    transition: all 0.2s;
}

.action-button:hover {
    background: #e5e7eb;
    border-color: #075e54;
    color: #075e54;
}

.action-icon {
    font-size: 20px;
    color: #075e54;
}

.system-status {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
}

.status-title {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    margin-bottom: 15px;
}

.status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #f1f1f1;
}

.status-item:last-child {
    border-bottom: none;
}

.status-label {
    font-size: 14px;
    color: #666;
}

.status-value {
    font-weight: 500;
    color: #333;
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-left: 8px;
}

.status-indicator.online {
    background: #28a745;
}

.status-indicator.warning {
    background: #ffc107;
}

.status-indicator.offline {
    background: #dc3545;
}

@media (max-width: 768px) {
    .dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .actions-grid {
        grid-template-columns: 1fr;
    }

    .card-number {
        font-size: 24px;
    }
}
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>Dashboard</h1>
        <p>Resumen del estado actual del sistema Prism</p>
    </div>
</div>

<div class="container">
    <!-- Dashboard Cards -->
    <div class="dashboard-grid">
        <div class="dashboard-card">
            <div class="card-header">
                <div class="card-icon conversations">
                    <i class="fa-solid fa-comments"></i>
                </div>
                <h3 class="card-title">Conversaciones Totales</h3>
            </div>
            <div class="card-number">{{ stats.total_conversations }}</div>
            <div class="card-description">Conversaciones registradas en el sistema</div>
        </div>

        <div class="dashboard-card">
            <div class="card-header">
                <div class="card-icon active">
                    <i class="fa-solid fa-message"></i>
                </div>
                <h3 class="card-title">Conversaciones Activas</h3>
            </div>
            <div class="card-number">{{ stats.active_conversations }}</div>
            <div class="card-description">Conversaciones en curso actualmente</div>
        </div>

        <div class="dashboard-card">
            <div class="card-header">
                <div class="card-icon areas">
                    <i class="fa-solid fa-sitemap"></i>
                </div>
                <h3 class="card-title">Áreas Configuradas</h3>
            </div>
            <div class="card-number">{{ stats.areas_configured }}</div>
            <div class="card-description">Áreas de derivación disponibles</div>
        </div>

        <div class="dashboard-card">
            <div class="card-header">
                <div class="card-icon responses">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <h3 class="card-title">Respuestas IA Hoy</h3>
            </div>
            <div class="card-number">{{ stats.ai_responses_today }}</div>
            <div class="card-description">Respuestas automáticas generadas</div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h3 class="actions-title">Acciones Rápidas</h3>
        <div class="actions-grid">
            <a href="/chats" class="action-button">
                <div class="action-icon">
                    <i class="fa-solid fa-comments"></i>
                </div>
                <div>
                    <div>Ver Chats</div>
                    <small>Gestionar conversaciones activas</small>
                </div>
            </a>

            <a href="/admin/areas" class="action-button">
                <div class="action-icon">
                    <i class="fa-solid fa-sitemap"></i>
                </div>
                <div>
                    <div>Configurar Áreas</div>
                    <small>Administrar áreas de derivación</small>
                </div>
            </a>

            <a href="/admin/iaconfig" class="action-button">
                <div class="action-icon">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <div>
                    <div>Configurar IA</div>
                    <small>Ajustar parámetros del asistente</small>
                </div>
            </a>

            <a href="/simulador" class="action-button">
                <div class="action-icon">
                    <i class="fa-solid fa-mobile-screen"></i>
                </div>
                <div>
                    <div>Simulador</div>
                    <small>Probar el sistema como cliente</small>
                </div>
            </a>
        </div>
    </div>

    <!-- System Status -->
    <div class="system-status">
        <h3 class="status-title">Estado del Sistema</h3>

        <div class="status-item">
            <span class="status-label">Servidor WebSocket</span>
            <div class="status-value">
                Conectado
                <span class="status-indicator online"></span>
            </div>
        </div>

        <div class="status-item">
            <span class="status-label">Base de Datos</span>
            <div class="status-value">
                Operacional
                <span class="status-indicator online"></span>
            </div>
        </div>

        <div class="status-item">
            <span class="status-label">Servicio de IA</span>
            <div class="status-value">
                Funcionando
                <span class="status-indicator online"></span>
            </div>
        </div>

        <div class="status-item">
            <span class="status-label">Última Actualización</span>
            <div class="status-value">
                Hace 2 minutos
                <span class="status-indicator online"></span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Actualizar datos cada 30 segundos
    setInterval(() => {
        console.log('Actualizando dashboard...');
        // Aquí puedes agregar lógica para actualizar los datos vía AJAX
    }, 30000);

    // Verificar estado del sistema
    async function checkSystemHealth() {
        try {
            const response = await fetch('/api/health');
            const health = await response.json();

            // Actualizar indicadores de estado
            updateStatusIndicators(health);
        } catch (error) {
            console.error('Error al verificar estado del sistema:', error);
        }
    }

    function updateStatusIndicators(health) {
        // Implementar lógica para actualizar indicadores
        console.log('Estado del sistema:', health);
    }

    // Verificar estado al cargar
    document.addEventListener('DOMContentLoaded', () => {
        checkSystemHealth();
    });
</script>
{% endblock %}